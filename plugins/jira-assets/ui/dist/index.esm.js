var PluginJiraAssets=function(m,e,l,s){"use strict";/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var fe={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=f=>f.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),O=(f,I)=>{const x=l.forwardRef(({color:w="currentColor",size:D=24,strokeWidth:P=2,absoluteStrokeWidth:p,className:E="",children:h,...y},n)=>l.createElement("svg",{ref:n,...fe,width:D,height:D,stroke:w,strokeWidth:p?Number(P)*24/Number(D):P,className:["lucide",`lucide-${ge(f)}`,E].join(" "),...y},[...I.map(([F,W])=>l.createElement(F,W)),...Array.isArray(h)?h:[h]]));return x.displayName=`${f}`,x};/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=O("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=O("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=O("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=O("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=O("ExternalLink",[["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}],["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["line",{x1:"10",x2:"21",y1:"14",y2:"3",key:"18c3s4"}]]);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=O("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=O("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=O("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=O("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),ke=({configData:f={},onConfigChange:I,onSaveConfiguration:x,onTestConnection:w,isSavingConfig:D=!1,isTestingConnection:P=!1,apiServices:p,pluginApiCall:E})=>{const h=l.useCallback(async(o,c,d)=>{var le;if(E)return E(o,c,d);if(!p)throw new Error("No API service available");const i=`/plugins/jira-assets${c.startsWith("/")?c:`/${c}`}`;let z;switch(o.toUpperCase()){case"GET":z=await p.get(i);break;case"POST":z=await p.post(i,d);break;case"PUT":z=await p.put(i,d);break;case"PATCH":z=await p.patch(i,d);break;case"DELETE":z=await p.delete(i);break;default:throw new Error(`Unsupported method: ${o}`)}return((le=z.data)==null?void 0:le.data)??z.data},[p,E]),y=!!(p||E),[n,F]=l.useState({deployment_type:"cloud",sync_enabled:!1,sync_interval_hours:24,...f}),[W,g]=l.useState(!1),[N,$]=l.useState([]),[T,Q]=l.useState([]),[S,H]=l.useState(!1),[R,V]=l.useState(!1),[j,G]=l.useState("idle"),[C,K]=l.useState(""),[ee,q]=l.useState(!1),[L,M]=l.useState(null),[A,re]=l.useState([]),[v,X]=l.useState(new Set),[se,oe]=l.useState(!1),[U,te]=l.useState(!1),[Z,_]=l.useState(null),[J,t]=l.useState([]),[r,a]=l.useState(!1),[k,b]=l.useState(!1),[u,Y]=l.useState(null);l.useEffect(()=>{if(W||!p)return;(async()=>{var c;try{const i=await p.get("/plugins/jira-assets/config"),z=((c=i.data)==null?void 0:c.data)??i.data;z&&F(le=>({...le,...z}))}catch(d){console.error("Failed to load JIRA config:",d)}finally{g(!0)}})()},[p,W]);const B=l.useCallback((o,c)=>{F(d=>({...d,[o]:c})),I&&I(o,c)},[I]),ye=l.useCallback(async()=>{if(!(!y||!n.jira_base_url||!n.workspace_id)){H(!0);try{const o=await h("GET","/schemas");o&&Array.isArray(o)&&$(o)}catch(o){console.error("Failed to load schemas:",o)}finally{H(!1)}}},[y,h,n.jira_base_url,n.workspace_id]),ae=l.useCallback(async o=>{if(!(!y||!o)){V(!0);try{const c=await h("GET",`/schemas/${o}/object-types`);console.log("[JiraConfig] loadObjectTypes response:",c,"isArray:",Array.isArray(c)),c&&Array.isArray(c)?Q(c):console.warn("[JiraConfig] Object types response is not an array:",typeof c)}catch(c){console.error("Failed to load object types:",c)}finally{V(!1)}}},[y,h]),pe=l.useCallback(async()=>{if(!(!y||!n.selected_object_type_id)){oe(!0),_(null);try{const o=await h("GET",`/object-types/${n.selected_object_type_id}/objects`);if(o&&Array.isArray(o)){const c=new Set(J.map(i=>i.jira_object_id)),d=o.filter(i=>!c.has(i.id));re(d)}}catch(o){_({type:"error",text:o.message||"Failed to load JIRA objects"})}finally{oe(!1)}}},[y,h,n.selected_object_type_id,J]),ne=l.useCallback(async()=>{if(y){a(!0);try{const o=await h("GET","/use-cases");o&&Array.isArray(o)&&t(o)}catch(o){console.error("Failed to load imported use cases:",o)}finally{a(!1)}}},[y,h]),Te=async()=>{if(!(!y||v.size===0)){te(!0),_(null);try{const o=await h("POST","/import",{object_ids:Array.from(v)});o!=null&&o.success?(_({type:"success",text:`Successfully imported ${o.imported} objects`}),X(new Set),await ne(),await pe()):_({type:"error",text:(o==null?void 0:o.error)||"Import failed"})}catch(o){_({type:"error",text:o.message||"Import failed"})}finally{te(!1)}}},we=async()=>{if(y){b(!0),Y(null);try{const o=await h("POST","/sync");o!=null&&o.success?(Y({type:"success",text:`Sync completed: ${o.objectsCreated||0} created, ${o.objectsUpdated||0} updated, ${o.objectsDeleted||0} deleted`}),await ne(),F(c=>({...c,last_sync_at:new Date().toISOString(),last_sync_status:"success"}))):Y({type:"error",text:(o==null?void 0:o.error)||"Sync failed"})}catch(o){Y({type:"error",text:o.message||"Sync failed"})}finally{b(!1)}}},ve=o=>{X(c=>{const d=new Set(c);return d.has(o)?d.delete(o):d.add(o),d})},ze=()=>{v.size===A.length?X(new Set):X(new Set(A.map(o=>o.id)))},Ie=async()=>{if(!y){w&&w();return}G("testing"),K("");try{const o=await h("POST","/test-connection",{configuration:{jira_base_url:n.jira_base_url,workspace_id:n.workspace_id,email:n.email,api_token:n.api_token,deployment_type:n.deployment_type||"cloud"}});o!=null&&o.success?(G("success"),K(o.message||"Connection successful. Click 'Save Configuration' to proceed to Step 2.")):(G("error"),K((o==null?void 0:o.message)||"Connection failed"))}catch(o){G("error"),K(o.message||"Connection test failed")}},je=async()=>{var o,c;if(p){q(!0),M(null);try{const d=await p.post("/plugins/jira-assets/config",{jira_base_url:n.jira_base_url,workspace_id:n.workspace_id,email:n.email,api_token:n.api_token||void 0,deployment_type:n.deployment_type||"cloud",selected_schema_id:n.selected_schema_id||void 0,selected_object_type_id:n.selected_object_type_id||void 0,sync_enabled:n.sync_enabled||!1,sync_interval_hours:n.sync_interval_hours||24}),i=((o=d.data)==null?void 0:o.data)??d.data;i!=null&&i.success?(M({type:"success",text:"Configuration saved successfully!"}),F(z=>({...z,has_api_token:!0})),g(!1)):M({type:"error",text:((c=i==null?void 0:i.errors)==null?void 0:c.join(", "))||(i==null?void 0:i.message)||"Failed to save configuration"})}catch(d){M({type:"error",text:d.message||"Failed to save configuration"})}finally{q(!1)}}},Ae=o=>{B("selected_schema_id",o),B("selected_object_type_id",""),Q([]),o&&ae(o)};l.useEffect(()=>{console.log("[JiraConfig] Schema load check:",{has_api_token:n.has_api_token,jira_base_url:n.jira_base_url,workspace_id:n.workspace_id,schemas_length:N.length}),n.has_api_token&&n.jira_base_url&&n.workspace_id&&N.length===0&&(console.log("[JiraConfig] Calling loadSchemas()"),ye())},[n.has_api_token,n.jira_base_url,n.workspace_id,ye,N.length]),l.useEffect(()=>{n.has_api_token&&n.selected_schema_id&&T.length===0&&ae(n.selected_schema_id)},[n.has_api_token,n.selected_schema_id,ae,T.length]),l.useEffect(()=>{y&&W&&ne()},[y,W,ne]);const Be=[{value:1,label:"Every hour"},{value:6,label:"Every 6 hours"},{value:12,label:"Every 12 hours"},{value:24,label:"Every 24 hours"},{value:48,label:"Every 48 hours"}];return e.jsxs(s.Box,{children:[e.jsx(s.Typography,{variant:"body2",color:"text.secondary",fontSize:13,sx:{mb:3},children:"Connect to your Jira Service Management Assets to import AI Systems as use-cases."}),e.jsx(s.Typography,{variant:"subtitle2",fontWeight:600,sx:{mb:2,color:"#344054"},children:"Step 1: Connection Settings"}),e.jsxs(s.Stack,{spacing:2.5,children:[e.jsxs(s.Box,{children:[e.jsx(s.Typography,{variant:"body2",fontWeight:500,fontSize:13,sx:{mb:.75,color:"#344054"},children:"Deployment Type *"}),e.jsx(s.FormControl,{fullWidth:!0,size:"small",children:e.jsxs(s.Select,{value:n.deployment_type||"cloud",onChange:o=>B("deployment_type",o.target.value),sx:{fontSize:"13px",backgroundColor:"white"},children:[e.jsx(s.MenuItem,{value:"cloud",sx:{fontSize:"13px"},children:"JIRA Cloud (Atlassian-hosted)"}),e.jsx(s.MenuItem,{value:"datacenter",sx:{fontSize:"13px"},children:"JIRA Data Center / Server (Self-hosted)"})]})}),e.jsx(s.Typography,{variant:"caption",color:"text.secondary",sx:{mt:.5,display:"block"},children:"Select Cloud for *.atlassian.net, or Data Center for self-hosted JIRA"})]}),e.jsxs(s.Box,{children:[e.jsx(s.Typography,{variant:"body2",fontWeight:500,fontSize:13,sx:{mb:.75,color:"#344054"},children:"JIRA Base URL *"}),e.jsx(s.TextField,{fullWidth:!0,placeholder:n.deployment_type==="datacenter"?"https://jira.your-company.com":"https://your-company.atlassian.net",value:n.jira_base_url||"",onChange:o=>B("jira_base_url",o.target.value),size:"small",sx:{"& .MuiOutlinedInput-root":{fontSize:"13px",backgroundColor:"white"}}})]}),e.jsxs(s.Box,{children:[e.jsxs(s.Typography,{variant:"body2",fontWeight:500,fontSize:13,sx:{mb:.75,color:"#344054"},children:[n.deployment_type==="datacenter"?"Insight Object Schema ID":"Workspace ID"," *"]}),e.jsx(s.TextField,{fullWidth:!0,placeholder:n.deployment_type==="datacenter"?"Enter object schema ID (e.g., 1)":"Enter your JSM Assets workspace ID",value:n.workspace_id||"",onChange:o=>B("workspace_id",o.target.value),size:"small",sx:{"& .MuiOutlinedInput-root":{fontSize:"13px",backgroundColor:"white"}}}),e.jsx(s.Typography,{variant:"caption",color:"text.secondary",sx:{mt:.5,display:"block"},children:n.deployment_type==="datacenter"?"For Data Center: Use object schema ID from Insight settings":"Found in Assets settings or the URL when viewing Assets"})]}),e.jsxs(s.Box,{children:[e.jsxs(s.Typography,{variant:"body2",fontWeight:500,fontSize:13,sx:{mb:.75,color:"#344054"},children:[n.deployment_type==="datacenter"?"Username":"Email"," *"]}),e.jsx(s.TextField,{fullWidth:!0,type:n.deployment_type==="datacenter"?"text":"email",placeholder:n.deployment_type==="datacenter"?"your-username":"your-email@company.com",value:n.email||"",onChange:o=>B("email",o.target.value),size:"small",sx:{"& .MuiOutlinedInput-root":{fontSize:"13px",backgroundColor:"white"}}})]}),e.jsxs(s.Box,{children:[e.jsxs(s.Typography,{variant:"body2",fontWeight:500,fontSize:13,sx:{mb:.75,color:"#344054"},children:[n.deployment_type==="datacenter"?"Password / Token":"API Token"," ",!n.has_api_token&&"*"]}),e.jsx(s.TextField,{fullWidth:!0,type:"password",placeholder:n.has_api_token&&!n.api_token?"••••••••••••••••  (saved - enter new value to change)":n.deployment_type==="datacenter"?"Enter your password or personal access token":"Enter your Atlassian API token",value:n.api_token||"",onChange:o=>B("api_token",o.target.value),size:"small",sx:{"& .MuiOutlinedInput-root":{fontSize:"13px",backgroundColor:"white"}}}),e.jsx(s.Typography,{variant:"caption",color:"text.secondary",sx:{mt:.5,display:"block"},children:n.has_api_token&&!n.api_token?"API token is saved. Leave empty to keep current token, or enter a new value to update.":n.deployment_type==="datacenter"?"Use your JIRA password or personal access token":"Generate at id.atlassian.com/manage-profile/security/api-tokens"})]})]}),j!=="idle"&&e.jsx(s.Box,{sx:{mt:2},children:e.jsx(s.Alert,{severity:j==="success"?"success":j==="error"?"error":"info",sx:{fontSize:"13px"},children:j==="testing"?"Testing connection...":C})}),L&&e.jsx(s.Box,{sx:{mt:2},children:e.jsx(s.Alert,{severity:L.type,sx:{fontSize:"13px"},onClose:()=>M(null),children:L.text})}),e.jsxs(s.Box,{sx:{display:"flex",justifyContent:"flex-end",gap:2,mt:2},children:[e.jsx(s.Button,{variant:"outlined",onClick:Ie,disabled:P||j==="testing"||!n.jira_base_url||!n.workspace_id||!n.email||!n.api_token&&!n.has_api_token,sx:{borderColor:"#13715B",color:"#13715B",textTransform:"none",fontSize:"13px",fontWeight:500,"&:hover":{borderColor:"#0f5a47",backgroundColor:"rgba(19, 113, 91, 0.04)"},"&:disabled":{borderColor:"#d0d5dd",color:"#98a2b3"}},children:P||j==="testing"?e.jsxs(e.Fragment,{children:[e.jsx(s.CircularProgress,{size:16,sx:{mr:1}}),"Testing..."]}):"Test Connection"}),e.jsx(s.Button,{variant:"contained",onClick:je,disabled:ee||!n.jira_base_url||!n.workspace_id||!n.email||!n.api_token&&!n.has_api_token,sx:{backgroundColor:"#13715B",textTransform:"none",fontSize:"13px",fontWeight:500,"&:hover":{backgroundColor:"#0f5a47"},"&:disabled":{backgroundColor:"#d0d5dd"}},children:ee?e.jsxs(e.Fragment,{children:[e.jsx(s.CircularProgress,{size:16,sx:{mr:1,color:"white"}}),"Saving..."]}):"Save Configuration"})]}),e.jsx(s.Divider,{sx:{my:3}}),e.jsx(s.Typography,{variant:"subtitle2",fontWeight:600,sx:{mb:2,color:"#344054"},children:"Step 2: Select Schema & Object Type"}),e.jsxs(s.Stack,{spacing:2.5,children:[e.jsxs(s.Box,{children:[e.jsx(s.Typography,{variant:"body2",fontWeight:500,fontSize:13,sx:{mb:.75,color:"#344054"},children:"Schema"}),e.jsx(s.FormControl,{fullWidth:!0,size:"small",children:e.jsxs(s.Select,{value:n.selected_schema_id||"",onChange:o=>Ae(o.target.value),disabled:S||N.length===0,displayEmpty:!0,sx:{fontSize:"13px",backgroundColor:"white"},children:[e.jsx(s.MenuItem,{value:"",sx:{fontSize:"13px"},children:S?"Loading schemas...":"Select a schema"}),N.map(o=>e.jsxs(s.MenuItem,{value:o.id,sx:{fontSize:"13px"},children:[o.name," (",o.objectSchemaKey,")"]},o.id))]})})]}),e.jsxs(s.Box,{children:[e.jsx(s.Typography,{variant:"body2",fontWeight:500,fontSize:13,sx:{mb:.75,color:"#344054"},children:"Object Type (AI Systems)"}),e.jsx(s.FormControl,{fullWidth:!0,size:"small",children:e.jsxs(s.Select,{value:n.selected_object_type_id||"",onChange:o=>B("selected_object_type_id",o.target.value),disabled:R||T.length===0||!n.selected_schema_id,displayEmpty:!0,sx:{fontSize:"13px",backgroundColor:"white"},children:[e.jsx(s.MenuItem,{value:"",sx:{fontSize:"13px"},children:R?"Loading object types...":"Select an object type"}),T.map(o=>e.jsxs(s.MenuItem,{value:o.id,sx:{fontSize:"13px"},children:[o.name,o.objectCount!==void 0&&e.jsx(s.Chip,{label:`${o.objectCount} objects`,size:"small",sx:{ml:1,fontSize:"11px"}})]},o.id))]})})]})]}),e.jsx(s.Divider,{sx:{my:3}}),e.jsx(s.Typography,{variant:"subtitle2",fontWeight:600,sx:{mb:2,color:"#344054"},children:"Step 3: Sync Settings"}),e.jsxs(s.Stack,{spacing:2.5,children:[e.jsx(s.Box,{children:e.jsx(s.FormControlLabel,{control:e.jsx(s.Switch,{checked:n.sync_enabled||!1,onChange:o=>B("sync_enabled",o.target.checked),sx:{"& .MuiSwitch-switchBase.Mui-checked":{color:"#13715B"},"& .MuiSwitch-switchBase.Mui-checked + .MuiSwitch-track":{backgroundColor:"#13715B"}}}),label:e.jsx(s.Typography,{variant:"body2",fontSize:13,sx:{color:"#344054"},children:"Enable automatic sync"})})}),n.sync_enabled&&e.jsxs(s.Box,{children:[e.jsx(s.Typography,{variant:"body2",fontWeight:500,fontSize:13,sx:{mb:.75,color:"#344054"},children:"Sync Interval"}),e.jsx(s.FormControl,{fullWidth:!0,size:"small",children:e.jsx(s.Select,{value:n.sync_interval_hours||24,onChange:o=>B("sync_interval_hours",o.target.value),sx:{fontSize:"13px",backgroundColor:"white"},children:Be.map(o=>e.jsx(s.MenuItem,{value:o.value,sx:{fontSize:"13px"},children:o.label},o.value))})})]})]}),n.last_sync_at&&e.jsx(s.Box,{sx:{mt:2},children:e.jsxs(s.Alert,{severity:n.last_sync_status==="success"?"success":"warning",sx:{fontSize:"13px"},children:["Last sync: ",new Date(n.last_sync_at).toLocaleString()," -"," ",n.last_sync_status==="success"?"Successful":n.last_sync_message]})}),n.has_api_token&&n.selected_object_type_id&&e.jsxs(e.Fragment,{children:[e.jsx(s.Divider,{sx:{my:3}}),e.jsxs(s.Box,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(s.Box,{children:[e.jsx(s.Typography,{variant:"subtitle2",fontWeight:600,sx:{color:"#344054"},children:"Import & Sync"}),e.jsxs(s.Typography,{variant:"body2",fontSize:12,color:"text.secondary",children:[J.length," use cases imported",n.last_sync_at&&` • Last sync: ${new Date(n.last_sync_at).toLocaleString()}`]})]}),e.jsxs(s.Box,{sx:{display:"flex",gap:1},children:[e.jsx(s.Button,{variant:"outlined",startIcon:k?e.jsx(s.CircularProgress,{size:14}):e.jsx(de,{size:14}),onClick:we,disabled:k||J.length===0,sx:{borderColor:"#13715B",color:"#13715B",textTransform:"none",fontSize:"13px","&:hover":{borderColor:"#0f5a47",backgroundColor:"rgba(19, 113, 91, 0.04)"},"&:disabled":{borderColor:"#d0d5dd",color:"#98a2b3"}},children:k?"Syncing...":"Sync Now"}),e.jsx(s.Button,{variant:"contained",startIcon:U?e.jsx(s.CircularProgress,{size:14,sx:{color:"white"}}):e.jsx(ce,{size:14}),onClick:pe,disabled:U||se,sx:{backgroundColor:"#13715B",textTransform:"none",fontSize:"13px","&:hover":{backgroundColor:"#0f5a47"},"&:disabled":{backgroundColor:"#d0d5dd"}},children:se?"Loading...":"Import"})]})]}),Z&&e.jsx(s.Alert,{severity:Z.type,sx:{mt:2,fontSize:"13px"},onClose:()=>_(null),children:Z.text}),u&&e.jsx(s.Alert,{severity:u.type,sx:{mt:2,fontSize:"13px"},onClose:()=>Y(null),children:u.text}),A.length>0&&e.jsxs(s.Box,{sx:{mt:2},children:[e.jsxs(s.Box,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[e.jsx(s.FormControlLabel,{control:e.jsx(s.Checkbox,{checked:v.size===A.length&&A.length>0,indeterminate:v.size>0&&v.size<A.length,onChange:ze,size:"small"}),label:e.jsxs(s.Typography,{variant:"body2",fontSize:13,children:["Select All (",A.length," available)"]})}),e.jsx(s.Button,{variant:"contained",onClick:Te,disabled:U||v.size===0,startIcon:U?e.jsx(s.CircularProgress,{size:14,sx:{color:"white"}}):e.jsx(ce,{size:14}),sx:{backgroundColor:"#13715B",textTransform:"none",fontSize:"13px","&:hover":{backgroundColor:"#0f5a47"}},children:U?"Importing...":`Import ${v.size} Selected`})]}),e.jsx(s.TableContainer,{component:s.Paper,sx:{maxHeight:250,boxShadow:"none",border:"1px solid #e4e7ec"},children:e.jsxs(s.Table,{size:"small",stickyHeader:!0,children:[e.jsx(s.TableHead,{children:e.jsxs(s.TableRow,{sx:{backgroundColor:"#f9fafb"},children:[e.jsx(s.TableCell,{padding:"checkbox"}),e.jsx(s.TableCell,{sx:{fontWeight:600,fontSize:"12px"},children:"Key"}),e.jsx(s.TableCell,{sx:{fontWeight:600,fontSize:"12px"},children:"Name"})]})}),e.jsx(s.TableBody,{children:A.map(o=>e.jsxs(s.TableRow,{hover:!0,selected:v.has(o.id),onClick:()=>ve(o.id),sx:{cursor:"pointer"},children:[e.jsx(s.TableCell,{padding:"checkbox",children:e.jsx(s.Checkbox,{checked:v.has(o.id),size:"small"})}),e.jsx(s.TableCell,{sx:{fontSize:"13px",fontFamily:"monospace"},children:o.key}),e.jsx(s.TableCell,{sx:{fontSize:"13px"},children:o.name})]},o.id))})]})})]}),J.length>0&&e.jsxs(s.Box,{sx:{mt:3},children:[e.jsx(s.Typography,{variant:"subtitle2",fontWeight:600,sx:{mb:1.5,color:"#344054"},children:"Imported Use Cases"}),e.jsx(s.TableContainer,{component:s.Paper,sx:{maxHeight:300,boxShadow:"none",border:"1px solid #e4e7ec"},children:e.jsxs(s.Table,{size:"small",stickyHeader:!0,children:[e.jsx(s.TableHead,{children:e.jsxs(s.TableRow,{children:[e.jsx(s.TableCell,{sx:{fontWeight:600,fontSize:"12px",backgroundColor:"#f9fafb"},children:"UC-ID"}),e.jsx(s.TableCell,{sx:{fontWeight:600,fontSize:"12px",backgroundColor:"#f9fafb"},children:"Name"}),e.jsx(s.TableCell,{sx:{fontWeight:600,fontSize:"12px",backgroundColor:"#f9fafb"},children:"JIRA Key"}),e.jsx(s.TableCell,{sx:{fontWeight:600,fontSize:"12px",backgroundColor:"#f9fafb"},children:"Status"})]})}),e.jsx(s.TableBody,{children:J.map(o=>{const c=typeof o.data=="string"?JSON.parse(o.data):o.data,d=(c==null?void 0:c.objectKey)||"-";return e.jsxs(s.TableRow,{hover:!0,children:[e.jsx(s.TableCell,{sx:{fontSize:"13px",fontFamily:"monospace"},children:o.uc_id}),e.jsx(s.TableCell,{sx:{fontSize:"13px"},children:o.name||(c==null?void 0:c.label)||"-"}),e.jsx(s.TableCell,{sx:{fontSize:"13px",fontFamily:"monospace"},children:d}),e.jsx(s.TableCell,{children:e.jsx(s.Chip,{label:o.sync_status,size:"small",color:o.sync_status==="synced"?"success":o.sync_status==="updated"?"info":"default",sx:{fontSize:"11px"}})})]},o.id)})})]})})]})]})]})},ue=({apiServices:f,pluginApiCall:I})=>{const x=l.useCallback(async(t,r,a)=>{var u;if(I)return I(t,r,a);if(!f)throw new Error("No API service available");const k=`/plugins/jira-assets${r.startsWith("/")?r:`/${r}`}`;let b;switch(t.toUpperCase()){case"GET":b=await f.get(k);break;case"POST":b=await f.post(k,a);break;case"PUT":b=await f.put(k,a);break;case"PATCH":b=await f.patch(k,a);break;case"DELETE":b=await f.delete(k);break;default:throw new Error(`Unsupported method: ${t}`)}return((u=b.data)==null?void 0:u.data)??b.data},[f,I]),w=!!(f||I),[D,P]=l.useState([]),[p,E]=l.useState(!0),[h,y]=l.useState(!1),[n,F]=l.useState(null),[W,g]=l.useState(null),[N,$]=l.useState(!1),[T,Q]=l.useState([]),[S,H]=l.useState(new Set),[R,V]=l.useState(!1),[j,G]=l.useState(!1),[C,K]=l.useState(null),[ee,q]=l.useState(!1),L=l.useCallback(async()=>{if(w){E(!0),g(null);try{const t=await x("GET","/use-cases");Array.isArray(t)&&P(t)}catch(t){g(t.message||"Failed to load use cases")}finally{E(!1)}}},[w,x]),M=l.useCallback(async()=>{if(w)try{const t=await x("GET","/sync/status");F(t)}catch(t){console.error("Failed to load sync status:",t)}},[w,x]);l.useEffect(()=>{L(),M()},[L,M]);const A=async()=>{if(w){y(!0),g(null);try{const t=await x("POST","/sync");t!=null&&t.success?(await L(),await M()):g((t==null?void 0:t.status)||"Sync failed")}catch(t){g(t.message||"Sync failed")}finally{y(!1)}}},re=async()=>{if(w){$(!0),V(!0),H(new Set),Q([]);try{const t=await x("GET","/config"),r=t==null?void 0:t.selected_object_type_id;if(!r){g("No object type configured. Please configure the plugin first."),V(!1);return}const a=await x("GET",`/object-types/${r}/objects`);if(Array.isArray(a)){const k=new Set(D.map(u=>u.jira_object_id)),b=a.filter(u=>!k.has(u.id));Q(b)}}catch(t){g(t.message||"Failed to load JIRA objects")}finally{V(!1)}}},v=t=>{H(r=>{const a=new Set(r);return a.has(t)?a.delete(t):a.add(t),a})},X=()=>{S.size===T.length?H(new Set):H(new Set(T.map(t=>t.id)))},se=async()=>{if(!(!x||S.size===0)){G(!0),g(null);try{const t=await x("POST","/import",{object_ids:Array.from(S)});t!=null&&t.success?($(!1),await L()):g((t==null?void 0:t.error)||"Import failed")}catch(t){g(t.message||"Import failed")}finally{G(!1)}}},oe=t=>{K(t),q(!0)},U=t=>{window.location.href=`/project-view?projectId=jira-assets-${t.project_id}`},te=t=>{var a;const r=typeof t.data=="string"?JSON.parse(t.data):t.data;return(r==null?void 0:r.label)||((a=r==null?void 0:r.attributes)==null?void 0:a.Name)||t.uc_id},Z=async t=>{if(w&&window.confirm(`Are you sure you want to delete "${te(t)}"?`))try{await x("DELETE",`/use-cases/${t.id}`),await L(),(C==null?void 0:C.id)===t.id&&(q(!1),K(null))}catch(r){g(r.message||"Failed to delete use case")}},_=t=>t?new Date(t).toLocaleString():"N/A",J=t=>{switch(t){case"synced":return e.jsx(s.Chip,{label:"Synced",size:"small",color:"success",sx:{fontSize:"11px"}});case"updated":return e.jsx(s.Chip,{label:"Updated",size:"small",color:"info",sx:{fontSize:"11px"}});case"deleted_in_jira":return e.jsx(s.Chip,{label:"Deleted in JIRA",size:"small",color:"error",sx:{fontSize:"11px"}});default:return e.jsx(s.Chip,{label:t,size:"small",sx:{fontSize:"11px"}})}};return e.jsxs(s.Box,{sx:{p:3},children:[e.jsxs(s.Box,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsxs(s.Box,{children:[e.jsx(s.Typography,{variant:"h6",fontWeight:600,children:"JIRA AI Systems"}),e.jsx(s.Typography,{variant:"body2",color:"text.secondary",fontSize:13,children:"AI Systems imported from Jira Service Management Assets"})]}),e.jsxs(s.Box,{sx:{display:"flex",gap:2},children:[e.jsx(s.Button,{variant:"outlined",startIcon:h?e.jsx(s.CircularProgress,{size:16}):e.jsx(de,{size:16}),onClick:A,disabled:h,sx:{borderColor:"#d0d5dd",color:"#344054",textTransform:"none",fontSize:"13px"},children:h?"Syncing...":"Sync Now"}),e.jsx(s.Button,{variant:"contained",startIcon:e.jsx(ce,{size:16}),onClick:re,sx:{backgroundColor:"#13715B",textTransform:"none",fontSize:"13px","&:hover":{backgroundColor:"#0f5a47"}},children:"Import from JIRA"})]})]}),n&&e.jsx(s.Alert,{severity:n.last_sync_status==="success"?"success":n.last_sync_status==="failed"?"warning":"info",sx:{mb:2,fontSize:"13px"},icon:e.jsx(Se,{size:18}),children:e.jsxs(s.Box,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsxs("span",{children:["Last sync: ",n.last_sync_at?_(n.last_sync_at):"Never"]}),n.sync_enabled&&e.jsx(s.Chip,{label:`Auto-sync: Every ${n.sync_interval_hours}h`,size:"small",color:"primary",variant:"outlined",sx:{fontSize:"11px"}})]})}),W&&e.jsx(s.Alert,{severity:"error",sx:{mb:2,fontSize:"13px"},onClose:()=>g(null),children:W}),p?e.jsx(s.Box,{sx:{display:"flex",justifyContent:"center",py:4},children:e.jsx(s.CircularProgress,{})}):D.length===0?e.jsxs(s.Paper,{sx:{p:4,textAlign:"center"},children:[e.jsx(be,{size:48,color:"#98a2b3"}),e.jsx(s.Typography,{variant:"h6",sx:{mt:2,color:"#344054"},children:"No JIRA AI Systems Imported"}),e.jsx(s.Typography,{variant:"body2",color:"text.secondary",sx:{mt:1},children:'Click "Import from JIRA" to start importing AI Systems from your JSM Assets.'})]}):e.jsx(s.TableContainer,{component:s.Paper,sx:{boxShadow:"none",border:"1px solid #e4e7ec"},children:e.jsxs(s.Table,{size:"small",children:[e.jsx(s.TableHead,{children:e.jsxs(s.TableRow,{sx:{backgroundColor:"#f9fafb"},children:[e.jsx(s.TableCell,{sx:{fontWeight:600,fontSize:"12px"},children:"UC-ID"}),e.jsx(s.TableCell,{sx:{fontWeight:600,fontSize:"12px"},children:"Name"}),e.jsx(s.TableCell,{sx:{fontWeight:600,fontSize:"12px"},children:"JIRA Key"}),e.jsx(s.TableCell,{sx:{fontWeight:600,fontSize:"12px"},children:"Sync Status"}),e.jsx(s.TableCell,{sx:{fontWeight:600,fontSize:"12px"},children:"Last Synced"}),e.jsx(s.TableCell,{sx:{fontWeight:600,fontSize:"12px"},align:"right",children:"Actions"})]})}),e.jsx(s.TableBody,{children:D.map(t=>{var a;const r=typeof t.data=="string"?JSON.parse(t.data):t.data;return e.jsxs(s.TableRow,{hover:!0,children:[e.jsx(s.TableCell,{sx:{fontSize:"13px",fontFamily:"monospace"},children:t.uc_id}),e.jsx(s.TableCell,{sx:{fontSize:"13px",cursor:"pointer",color:"#13715B","&:hover":{textDecoration:"underline"}},onClick:()=>U(t),children:(r==null?void 0:r.label)||((a=r==null?void 0:r.attributes)==null?void 0:a.Name)||"-"}),e.jsx(s.TableCell,{sx:{fontSize:"13px",fontFamily:"monospace"},children:(r==null?void 0:r.objectKey)||"-"}),e.jsx(s.TableCell,{children:J(t.sync_status)}),e.jsx(s.TableCell,{sx:{fontSize:"12px",color:"#667085"},children:_(t.last_synced_at)}),e.jsxs(s.TableCell,{align:"right",children:[e.jsx(s.Tooltip,{title:"Open Use Case",children:e.jsx(s.IconButton,{size:"small",onClick:()=>U(t),color:"primary",children:e.jsx(Ce,{size:16})})}),e.jsx(s.Tooltip,{title:"View JIRA Data",children:e.jsx(s.IconButton,{size:"small",onClick:()=>oe(t),children:e.jsx(_e,{size:16})})}),e.jsx(s.Tooltip,{title:"Delete",children:e.jsx(s.IconButton,{size:"small",onClick:()=>Z(t),color:"error",children:e.jsx(ie,{size:16})})})]})]},t.id)})})]})}),e.jsxs(s.Dialog,{open:N,onClose:()=>$(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(s.DialogTitle,{children:e.jsxs(s.Box,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(s.Typography,{variant:"h6",children:"Import AI Systems from JIRA"}),e.jsx(s.IconButton,{onClick:()=>$(!1),children:e.jsx(he,{size:20})})]})}),e.jsx(s.DialogContent,{dividers:!0,children:R?e.jsxs(s.Box,{sx:{py:4,textAlign:"center"},children:[e.jsx(s.CircularProgress,{}),e.jsx(s.Typography,{sx:{mt:2},children:"Loading objects from JIRA..."})]}):T.length===0?e.jsx(s.Alert,{severity:"info",children:"No new objects to import. All JIRA objects have already been imported."}):e.jsxs(e.Fragment,{children:[e.jsxs(s.Box,{sx:{mb:2,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(s.FormControlLabel,{control:e.jsx(s.Checkbox,{checked:S.size===T.length&&T.length>0,indeterminate:S.size>0&&S.size<T.length,onChange:X,size:"small"}),label:e.jsxs(s.Typography,{variant:"body2",fontSize:13,children:["Select All (",T.length," objects)"]})}),e.jsxs(s.Typography,{variant:"body2",color:"text.secondary",children:[S.size," selected"]})]}),e.jsx(s.TableContainer,{sx:{maxHeight:400},children:e.jsxs(s.Table,{size:"small",stickyHeader:!0,children:[e.jsx(s.TableHead,{children:e.jsxs(s.TableRow,{children:[e.jsx(s.TableCell,{padding:"checkbox"}),e.jsx(s.TableCell,{sx:{fontWeight:600,fontSize:"12px"},children:"Key"}),e.jsx(s.TableCell,{sx:{fontWeight:600,fontSize:"12px"},children:"Name"}),e.jsx(s.TableCell,{sx:{fontWeight:600,fontSize:"12px"},children:"Updated"})]})}),e.jsx(s.TableBody,{children:T.map(t=>e.jsxs(s.TableRow,{hover:!0,selected:S.has(t.id),onClick:()=>v(t.id),sx:{cursor:"pointer"},children:[e.jsx(s.TableCell,{padding:"checkbox",children:e.jsx(s.Checkbox,{checked:S.has(t.id),size:"small"})}),e.jsx(s.TableCell,{sx:{fontSize:"13px",fontFamily:"monospace"},children:t.key}),e.jsx(s.TableCell,{sx:{fontSize:"13px"},children:t.name}),e.jsx(s.TableCell,{sx:{fontSize:"12px",color:"#667085"},children:_(t.updated)})]},t.id))})]})})]})}),e.jsxs(s.DialogActions,{sx:{p:2},children:[e.jsx(s.Button,{onClick:()=>$(!1),sx:{textTransform:"none"},children:"Cancel"}),e.jsx(s.Button,{variant:"contained",onClick:se,disabled:j||S.size===0,startIcon:j?e.jsx(s.CircularProgress,{size:16}):e.jsx(xe,{size:16}),sx:{backgroundColor:"#13715B",textTransform:"none","&:hover":{backgroundColor:"#0f5a47"}},children:j?"Importing...":`Import ${S.size} Objects`})]})]}),e.jsx(s.Drawer,{anchor:"right",open:ee,onClose:()=>q(!1),children:e.jsx(s.Box,{sx:{width:480,p:3},children:C&&(()=>{var k;const t=typeof C.data=="string"?JSON.parse(C.data):C.data,r=(t==null?void 0:t.label)||((k=t==null?void 0:t.attributes)==null?void 0:k.Name)||C.uc_id,a=(t==null?void 0:t.objectKey)||"-";return e.jsxs(e.Fragment,{children:[e.jsxs(s.Box,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:3},children:[e.jsxs(s.Box,{children:[e.jsx(s.Typography,{variant:"h6",children:r}),e.jsxs(s.Typography,{variant:"body2",color:"text.secondary",sx:{fontFamily:"monospace"},children:[C.uc_id," | ",a]})]}),e.jsx(s.IconButton,{onClick:()=>q(!1),children:e.jsx(he,{size:20})})]}),e.jsxs(s.Stack,{spacing:2,children:[e.jsx(s.Box,{sx:{display:"flex",gap:1},children:J(C.sync_status)}),e.jsx(s.Divider,{}),e.jsxs(s.Box,{children:[e.jsx(s.Typography,{variant:"subtitle2",fontWeight:600,sx:{mb:1},children:"Sync Information"}),e.jsxs(s.Stack,{spacing:1,children:[e.jsxs(s.Box,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(s.Typography,{variant:"body2",color:"text.secondary",children:"Last Synced"}),e.jsx(s.Typography,{variant:"body2",children:_(C.last_synced_at)})]}),e.jsxs(s.Box,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(s.Typography,{variant:"body2",color:"text.secondary",children:"JIRA Created"}),e.jsx(s.Typography,{variant:"body2",children:_(t==null?void 0:t.created)})]}),e.jsxs(s.Box,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(s.Typography,{variant:"body2",color:"text.secondary",children:"JIRA Updated"}),e.jsx(s.Typography,{variant:"body2",children:_(t==null?void 0:t.updated)})]})]})]}),e.jsx(s.Divider,{}),e.jsxs(s.Box,{children:[e.jsx(s.Typography,{variant:"subtitle2",fontWeight:600,sx:{mb:1},children:"JIRA Attributes"}),e.jsx(s.Stack,{spacing:1,children:Object.entries((t==null?void 0:t.attributes)||{}).map(([b,u])=>e.jsxs(s.Box,{children:[e.jsx(s.Typography,{variant:"caption",color:"text.secondary",sx:{display:"block"},children:b}),e.jsx(s.Typography,{variant:"body2",sx:{wordBreak:"break-word"},children:Array.isArray(u)?u.join(", "):String(u??"N/A")})]},b))})]}),e.jsx(s.Divider,{}),e.jsx(s.Box,{sx:{display:"flex",gap:2},children:e.jsx(s.Button,{variant:"outlined",color:"error",fullWidth:!0,onClick:()=>Z(C),startIcon:e.jsx(ie,{size:16}),sx:{textTransform:"none"},children:"Delete"})})]})]})})()})})]})};return m.JiraAssetsConfiguration=ke,m.JiraAssetsUseCasesTab=ue,Object.defineProperty(m,Symbol.toStringTag,{value:"Module"}),m}({},jsxRuntime,React,MUI);
//# sourceMappingURL=index.esm.js.map
